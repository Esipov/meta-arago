From b5bd9af7136d8ffefc732cf5602eb7927a947f2b Mon Sep 17 00:00:00 2001
From: Harinarayan Bhatta <harinarayan@ti.com>
Date: Wed, 10 Aug 2016 11:13:53 +0530
Subject: [PATCH 1/5] plat-ti: Fixed issues with MMU mapping

Signed-off-by: Harinarayan Bhatta <harinarayan@ti.com>
---
 core/arch/arm/plat-ti/main.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/core/arch/arm/plat-ti/main.c b/core/arch/arm/plat-ti/main.c
index fe2a1d2..0935b1c 100644
--- a/core/arch/arm/plat-ti/main.c
+++ b/core/arch/arm/plat-ti/main.c
@@ -77,7 +77,7 @@ static vaddr_t console_base(void)
 
 	if (cpu_mmu_enabled()) {
 		if (!va)
-			va = phys_to_virt(CONSOLE_UART_BASE, MEM_AREA_IO_SEC);
+			va = phys_to_virt(CONSOLE_UART_BASE, MEM_AREA_IO_NSEC);
 		return (vaddr_t)va;
 	}
 	return CONSOLE_UART_BASE;
@@ -130,11 +130,12 @@ struct plat_nsec_ctx {
 
 void init_sec_mon(unsigned long nsec_entry)
 {
-	struct plat_nsec_ctx *plat_ctx = (struct plat_nsec_ctx *)nsec_entry;
+	struct plat_nsec_ctx *plat_ctx = (struct plat_nsec_ctx *)
+		(phys_to_virt(nsec_entry,MEM_AREA_IO_SEC));
 	struct sm_nsec_ctx *nsec_ctx;
 
 	/* Invalidate cache to fetch data from external memory */
-	cache_maintenance_l1(DCACHE_AREA_INVALIDATE, (void *)nsec_entry,
+	cache_maintenance_l1(DCACHE_AREA_INVALIDATE, (void *)plat_ctx,
 		sizeof(struct plat_nsec_ctx));
 
 	/* Initialize secure monitor */
-- 
2.9.3

